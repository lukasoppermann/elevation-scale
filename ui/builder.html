<h2>Rectangle Creator</h2>
<p>Count: <input data-property="count" value="5"></p>
<div id="shadows">

</div>
<button id="add">Add Shadow</button>

<div class="section">
  <label><input type="checkbox" data-property="createStyles" />Create styles</label>
</div>

<footer>
  <button id="create">Save</button>
  <button id="cancel">Cancel</button>
</footer>

<template id="shadowTemplate">
  <details class="shadow">
    <summary><input class="name" value="shadow"><button class="delete" data-action="deleteItem">ðŸ—‘</button></summary>
    <div>Type: 
      <select data-property="effectType">
        <option value="dropshadow">Dropshadow</option>
        <option value="innershadow">Innershadow</option>
      </select>
    </div>
    <p>X: <input data-property="x" value="0"></p>
    <p>Y: <input data-property="y" value="0"></p>
    <p>Blur: <input data-property="blur" value="0"></p>
    <p>Spread: <input data-property="spread" value="0"></p>
    <p>Color: <input data-property="color" value="#000000"></p>
    <p>Opacity: <input data-property="opacity" value="10"></p>
  </details>
</template>
<script> 
const template = document.getElementById("shadowTemplate")
const list = document.getElementById("shadows")

const getShadowLayerValues = shadowDetails => {
  const properties = [
    'effectType',
    'x',
    'y',
    'blur',
    'spread',
    'color',
    'opacity'
  ]

  let propertyValues = {}

  properties.forEach(property => {
    propertyValues[property] = shadowDetails.querySelector(`[data-property="${property}"]`).value
  })
  // return values
  return propertyValues
}

const saveShadows = (list) => {
  // get the amount of shadows
  const count = document.querySelector('[data-property="count"]').value;
  // create styles?
  const createStyles = document.querySelector('[data-property="createStyles"]').value;
  // get data for each shadow layer
  const shadowLayers = Array.from(list.querySelectorAll('details')).map(shadowDetails => getShadowLayerValues(shadowDetails))
  // send data
  parent.postMessage({ pluginMessage: 
    { 
      type: 'saveShadows',
      count,
      createStyles,
      shadowLayers
    } 
  }, '*')
}

document.getElementById('create').onclick = () => {
  saveShadows(list)
}

document.getElementById('cancel').onclick = () => {
  parent.postMessage({ pluginMessage: { type: 'cancel' } }, '*')
}

const addShadowLayer = () => {
  const clone = template.content.cloneNode(true)
  list.appendChild(clone);
}

document.getElementById('add').onclick = () => {
  addShadowLayer()
}

list.onclick = (e) => {
  if(e.target.dataset.action === 'deleteItem') {
    e.target.parentNode.parentNode.remove()
  }
}

// add one shadow layer by default
addShadowLayer()

</script>

<!-- https://github.com/KaneCohen/tokenfield -->